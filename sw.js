/* ! speed-kit 1.8.0 | Copyright (c) 2018 Baqend GmbH */
!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{}function n(t){return`regexp:/${t.source}/${t.flags||""}`}function r(t){if("string"!=typeof t)return null;const e=/^regexp:\/(.*)\/([\w]*)$/.exec(t);if(e){const[,t,s]=e;return new RegExp(t,s)}return null}function a(t){return JSON.parse(t,(t,e)=>"string"==typeof e&&r(e)||e)}var o;i.propName="",function(t){t.Document="document",t.Audio="audio",t.Video="video",t.Track="track",t.Image="image",t.Style="style",t.Script="script",t.Font="font"}(o||(o={}));const c=[o.Document,o.Script,o.Style];function l(t,e){return new Request(t,e)}function h(t){const e=u(t),s=".svg"===d(t);return!e||c.includes(e)||s}function u(t){const e=function(t){for(const e of Object.values(o))if(e===t)return e;return null}(t.destination||"");if(e)return e;const s=function(t){const e=[];if(!t||"*/*"===t)return null;(t.includes("text/html")||t.includes("application/xhtml+xml"))&&e.push(o.Document);t.includes("text/css")&&e.push(o.Style);(t.includes("text/javascript")||t.includes("application/javascript"))&&e.push(o.Script);t.includes("image/")&&e.push(o.Image);t.includes("font/")&&e.push(o.Font);t.includes("video/")&&e.push(o.Video);t.includes("audio/")&&e.push(o.Audio);t.includes("text/vtt")&&e.push(o.Track);return 1===e.length?e[0]:null}(t.headers.get("Accept")||"");if(s)return s;if("navigate"===t.mode)return o.Document;const i=function(t){switch(t){case".js":return o.Script;case".html":case".htm":return o.Document;case".css":return o.Style;case".woff2":case".woff":case".ttf":case".otf":return o.Font;case".mp3":case".wav":return o.Audio;case".vtt":return o.Track;case".png":case".jpeg":case".jpg":case".gif":case".svg":case".ico":case".webp":return o.Image;case".mp4":case".ogg":case".ogv":case".webM":return o.Video;default:return null}}(d(t));return i||(new URL(t.url).pathname.endsWith("/")?o.Document:null)}function d(t){const e=new URL(t.url),s=e.pathname.lastIndexOf(".");return-1===s?"":e.pathname.substr(s)}class p extends i{constructor(t=[]){super(),this._v=t}matches(t,e){if(!this._v.length)return!1;const s=u(t);return!!s&&this._v.includes(s)}toJSON(){return this._v}fromJSON(t){if("string"==typeof t)return this.fromJSON(a(t));if(t instanceof Array)return this._v=t,this;throw new Error("Invalid ContentTypeCondition JSON")}}p.propName="contentType";class m extends i{constructor(t){super(),this._4=t}test(t){return null!=this._4&&function t(e,s){return s instanceof Array?s.some(s=>t(e,s)):s instanceof RegExp?s.test(e):e.startsWith(s)}(t,this._4)}toJSON(){return this._4?function t(e){return e instanceof Array?e.map(e=>t(e)):e instanceof RegExp?n(e):e}(this._4):null}fromJSON(t){if(null==t||"null"===t)return this._4=null,this;try{return this.fromJSON(a(t))}catch(t){}return this._4=t,this}}function f(t){const[,e]=/^(?:(?:\w+?:)?\/\/)?(.*)$/.exec(t);return e}function g(t){const[,e,s,i,n,r,a]=/^(?:(https?:)\/\/)?(([\w.-]+)(?::(\d+))?)([^#]*)(#.*)?$/.exec(t);return{protocol:e,host:s,hostname:i,port:n,pathname:r,hash:a}}class _ extends m{matches(t,e){return!!e&&(!!f(t.url).startsWith(location.host)&&e.keys().some(t=>this.test(t)))}}_.propName="cookie";class w extends i{matches(t,e){const s=t.headers.get("user-agent")||navigator.userAgent;return!s||this.userAgentMatches(s)}toJSON(){return!0}fromJSON(t){return this}}class v extends w{userAgentMatches(t){const e=t.toLowerCase();return e.includes("wow64")||e.includes("windows nt")||e.includes("win64")||e.includes("msie")||e.includes("macintosh;")||e.includes("linux x86_64")}}v.propName="desktop";class b extends m{matches(t,e){return this.test(g(t.url).host)}}b.propName="host";class y extends w{userAgentMatches(t){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(?:browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br[ev]w|bumb|bw\-[nu]|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c[- ]|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}}y.propName="mobile";class k extends m{matches(t,e){return this.test(g(t.url).pathname)}}k.propName="pathname";class x extends m{matches(t,e){return this.test(f(t.url))}}x.propName="url";class S extends w{userAgentMatches(t){const e=t.toLowerCase();return e.includes("tablet")||e.includes("ipad")||e.includes("nexus 7")||e.includes("nexus 10")||e.includes("silk/")||!!e.match(/\bgt-[pn]\d{4}\b/)}}S.propName="tablet";class O extends w{userAgentMatches(t){const e=t.toLowerCase();return e.includes("appletv")||e.includes("apple tv")||e.includes("googletv")||e.includes("crkey")||e.includes("armv7l")||e.includes("aftt")||e.includes("aftm")||e.includes("roku")||e.includes("bravia")||e.includes("philipstv")||e.includes("tsbnettv")||e.includes("smarttv")||!!e.match(/\btv\b/)}}O.propName="tv";const C={[p.propName]:p,[_.propName]:_,[v.propName]:v,[b.propName]:b,[y.propName]:y,[k.propName]:k,[S.propName]:S,[O.propName]:O,[x.propName]:x};class N extends i{constructor(t=[]){super(),this._u=t}matches(t,e){return!!this._u.length&&this._u.every(s=>s.matches(t,e))}toJSON(){const t={};for(const e of this._u){t[e.constructor.propName]=e.toJSON()}return t}fromJSON(t){if("string"==typeof t)return this.fromJSON(a(t));for(const[e,s]of Object.entries(t)){if(!C[e])throw new Error(`Illegal rule: ${e}`);{const t=new C[e];t.fromJSON(s),this.addCondition(t)}}return this}addCondition(t){return this._u.push(t)}removeCondition(t){const e=this._u.indexOf(t);return!(e<0)&&(this._u.splice(e,1),!0)}}class q extends i{constructor(t=[]){super(),this._t=t}get size(){return this._t.length}toJSON(){return this._t.map(t=>t.toJSON())}fromJSON(t){if("string"==typeof t)return this.fromJSON(a(t));if(t instanceof Array)return this._t=t.map(t=>(new N).fromJSON(t)),this;throw new Error("Invalid RuleSet JSON")}matches(t,e){return this._t.some(s=>s.matches(t,e))}[Symbol.iterator](){return this._t[Symbol.iterator]()}addRule(t){return this._t.push(t)}removeRule(t){const e=this._t.indexOf(t);return!(e<0)&&(this._t.splice(e,1),!0)}}const R="baqend-speedkit";async function P(t,e,s){const i=caches.open(s);return(await i).put(t,e)}async function F(t,e){return P(t,new Response(null,{status:200,statusText:(s=e,JSON.stringify(s,(t,e)=>e instanceof RegExp?n(e):e))}),R);var s}async function A(t,e){const s=caches.open(e);return(await s).match(t,{cacheName:e})}async function E(t,e){const s=await A(t,R);return s?a(s.statusText):e}const $=-1,D=0,j="https://fetch.origin.time/",I=2;var W,J,U;(J=W||(W={})).Url="url",J.DisableCaching="noCaching",J.CacheAll="cacheAll",J.BlockExternal="blockExternal",J.Blacklist="blacklist",J.Whitelist="whitelist",J.UserAgentDetection="agentDetec";class z{constructor(t){this.originFetchDelay=5e3,this._0=null,this._1=null,this._2=!0,this._3={blacklist:new q,whitelist:new q,cacheAll:!1,disableCache:!1,userAgentDetection:!1,enabledSites:new q,fetchOriginInterval:-1,image:this._z()},Object.assign(this._3,t)}isCachingEnabled(){return!this._3.disableCache}shouldCacheRequest(t,e){return!this._3.disableCache&&(!!this._3.cacheAll||!(this._3.whitelist.size&&!this._3.whitelist.matches(t,e))&&(!this._3.blacklist.matches(t,e)&&(this._3.enabledSites.size&&"navigate"===t.mode&&(this._2=this._3.enabledSites.matches(t,e)),this._2)))}async isEnabledOnSite(t,e){if(!this._3.enabledSites||!this._3.enabledSites.size)return!0;if("navigate"===t.request.mode)return!0;const s=await self.clients.get(t.clientId);return this._3.enabledSites.matches(new Request(s.url),e)}getUserAgentClass(t){if(!this._3.userAgentDetection)return null;const e=t.headers.get("user-agent")||navigator.userAgent||navigator.vendor,s="navigate"===t.mode&&e!==this._1;return null==this._0||s?(this._1=e,this._w(e)?this._0="mobile":this._x(e)?this._0="tablet":this._0=this._y(e)?"tv":"desktop"):this._0}async shouldFetchOrigin(t){if("navigate"!==t.mode||this._3.fetchOriginInterval===$)return!1;if(this._3.fetchOriginInterval===D)return!0;const e=Math.floor(Date.now()/1e3),s=await E(j,e);return s<=e&&(await F(j,s+this._3.fetchOriginInterval+I),!0)}getImageOptions(t){const e=this._z();if(this._3.image instanceof Array){for(const s of this._3.image)s.rules&&!s.rules.matches(t)||Object.assign(e,s.options);return e}return Object.assign(e,this._3.image)}_w(t){const e=t;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|symbian|treo|up\.(?:browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br[ev]w|bumb|bw\-[nu]|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c[- ]|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}_x(t){if(["iPad","Linux armv"].some(t=>navigator.platform.startsWith(t)))return!0;return t.includes("Tablet PC")}_y(t){const e=navigator.platform.toLowerCase();if(["nintendo","playstation"].some(t=>e.startsWith(t)))return!0;const s=t;return!!(s.toLowerCase().includes("appletv")||s.includes("googletv")||s.includes("smarttv"))}_z(){return{downscale:!0,screenSizeFactor:1,maxWidth:!1,quality:85,webp:!0,pjpeg:!0,crop:!1}}}function T(t,e){const s=t.headers.get("date")||"";return Date.parse(s)+e}function B(t,e){const s=t.headers.get("baqend-sw-control")||t.headers.get("cache-control"),i=t.headers.get("date");if(i&&s){const n=function(t){const e=t.split(/,\s*/);for(const t of e)if(t.includes("max-age"))return parseInt(t.substr(t.indexOf("=")+1,t.length-t.indexOf("=")),10);return 0}(s),r=parseInt(t.headers.get("age")||"0",10),a=(new Date(i),T(t,e)+1e3*(n-r));return Date.now()<a}const n=t.headers.get("expires");return!!n&&Date.now()<new Date(n).getTime()}async function L(t,e){const s=await t.blob();return new Response(s,e)}function M(t){return new Promise(e=>setTimeout(e,t))}function G(){const{userAgent:t}=navigator,e=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];let s=null;if(/trident/i.test(e[1]))return s=/\brv[ :]+(\d+)/g.exec(t)||[],["IE ",parseInt(s[1],10)||0];const i=e[2]?[e[1],parseInt(e[2],10)]:[navigator.appName,parseInt(navigator.appVersion,10)];return null!=(s=t.match(/version\/(\d+)/i))&&i.splice(1,1,parseInt(s[1],10)),i}!function(t){t[t.Ok=200]="Ok",t[t.BaqendRedirect=231]="BaqendRedirect",t[t.MovedPermanently=301]="MovedPermanently",t[t.BadRequest=400]="BadRequest",t[t.Forbidden=403]="Forbidden",t[t.InternalServerError=500]="InternalServerError",t[t.BadGateway=502]="BadGateway",t[t.FetchTypeError=542]="FetchTypeError"}(U||(U={}));class H{constructor(t,e={},s=location.origin){this.bloomFilterProvider=t,this.options=new z(e),this.appUrl=s+"/";const[i,n]=G();this._s=!("Chrome"===i&&n<64||"Firefox"===i&&n<61)}async handleRequest(t,e,s){const i="HEAD"===t.method?l(t,{method:"GET"}):t,n=await A(i,this._r(i));if(e&&(e.waitFor(this._k(t)),e.finishWaiting(!0)),n)return this._l(i,n);if(!i.url.startsWith(location.origin))return this._m(i);const r=await this._j(i);return r||this._m(i)}handleExternalRequest(t){if("navigate"===t.mode)return this._o(t);const e=l(t,{mode:this._q(t)});return this._o(e)}shouldHandle(t,e){return this.options.shouldCacheRequest(t,e)}async isEnabledOnSite(t,e){return this.options.isEnabledOnSite(t,e)}async fetchEnhanced(t){try{const e=l(t,{mode:this._q(t)});return await this._o(e)}catch(t){const e=t instanceof TypeError?U.FetchTypeError:U.BadGateway;return new Response(t.message,{status:e})}}async _j(t){if("navigate"===t.mode||!this._s)return null;try{const e=await fetch(t.url,{mode:"same-origin",cache:"only-if-cached"});if(B(e,this.bloomFilterProvider.getClockDrift()))return e}catch(t){}return null}async _k(t){if(await this.options.shouldFetchOrigin(t)){await M(1e3*I);try{await this._o(t)}catch(t){}}}async _l(t,e){if(!navigator.onLine)return e;return B(e,this.bloomFilterProvider.getClockDrift())&&this._p(t)&&!this.isCorrupted(t,e)?e:this._m(t)}isCorrupted(t,e){return!1}async _m(t){const e=await this.fetchEnhanced(t);return this._n(t,e)}async _n(t,e){return e.status>=U.InternalServerError?(this.bloomFilterProvider.disconnect("reconnect"),this._o(t)):e.status>=U.BadRequest?this._o(t):this.options.isCachingEnabled()?(P(t,e.clone(),this._r(t)).then(()=>{}),e):e}_o(t){return fetch(t)}_p(t){const e=t.url;if(this.bloomFilterProvider.isNotReady())return!1;const s=e.includes("#")?e.substr(0,e.indexOf("#")):e;return!this.bloomFilterProvider.isStale(s)}_q(t){const e=t.url;return e.startsWith(location.origin)?"same-origin":t.headers.has("origin")||e.startsWith(this.appUrl)?"cors":"no-cors"}_r(t){const e=this.options.getUserAgentClass(t);return`${R}-${e||"assets"}-${this.bloomFilterProvider.getRevision()}`}}class V extends H{constructor(t,e={},s=location.origin){super(t,e,s),this.apiPrefix=`${s}/v1/`,this.assetPrefix=`${this.apiPrefix}asset/`}async rewriteRequest(t){return this._a(t)?t:this._b(t)}async fetchEnhanced(t){const e=await this.rewriteRequest(t),s=await super.fetchEnhanced(e),i=await this.handleRedirect(s,t);return this._Z(t,i)}isCorrupted(t,e){return!(!e.url||!h(t))&&e.url.includes("/v1/asset/")}async _Z(t,e){if(!h(t))return e;const s=await async function(t,e={}){const s={status:t.status,statusText:t.statusText,headers:t.headers},i=Object.assign(s,e);if(!t.body)return await L(t,i);try{return new Response(t.body,i)}catch(e){return await L(t,i)}}(e);return Object.defineProperty(s,"url",{value:t.url}),s}_a(t){return t.url.startsWith(this.apiPrefix)}async _b(t){const e=new URL(t.url);e.hash="";const s=this.options.getUserAgentClass(t);s&&"desktop"!==s&&e.searchParams.append("bqvariation",s);const i=await this._c(t,e),n=this.assetPrefix+i.toString();return this.changeRequestUrl(t,n)}async _c(t,e){if(u(t)!==o.Image)return e;if(".svg"===d(t))return e;const s=[],i=this.options.getImageOptions(t);if(i.downscale&&(this.screen||(this.screen=await E(`${location.origin}/com.baqend.speedkit.screen`)),this.screen)){const{width:t,dpr:e}=this.screen,n=i.maxWidth?0+i.maxWidth:t,r=this._d(n,e*i.screenSizeFactor);!isNaN(r)&&r>0&&s.push(`width=${r}`)}i.webp&&s.push("auto=webp"),100!==i.quality&&s.push(`quality=${i.quality}`),i.pjpeg&&e.pathname.match(/\.jpe?g$/i)&&s.push("format=pjpeg");const n=i.crop;if(n)if("string"==typeof n)s.push(`crop=${n},smart`);else if(n instanceof Array)if(n.length>=4){const[t,e,i,r]=n;s.push(`crop=${i},${r},x${t},y${e}`)}else if(n.length>=2){const[t,e]=n;s.push(`crop=${t},${e},smart`)}return s.length&&(e.searchParams.append("bqoptimize","1"),e.search+=`;${s.join(";")}`),e}_d(t,e){const s=t*e;return s<=576?576:s<=768?768:s<=992?992:s<=1200?1200:s<=1920?1920:s<=2560?2560:s<=3840?3840:s}async changeRequestUrl(t,e,s={}){const i=new Headers,n=["accept","accept-language","content-language","content-type"];for(const[e,s]of t.headers)n.includes(e.toLocaleLowerCase())&&i.append(e,s);const r={headers:i,credentials:"omit"};return"navigate"!==t.mode&&(r.mode=t.mode),new Request(e,Object.assign(r,s))}}var K=function(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&(s[i[n]]=t[i[n]])}return s};class X extends V{constructor(t,e){const{whitelist:s,blacklist:i,appName:n,enabledSites:r,image:a}=e,o=K(e,["whitelist","blacklist","appName","enabledSites","image"]),c=Object.assign({appDomain:"{}.app.baqend.com".replace("{}",n),cacheAll:!1,disableCache:!1,userAgentDetection:!1,fetchOriginInterval:-1,whitelist:(new q).fromJSON(s||[]),blacklist:(new q).fromJSON(i||[]),enabledSites:(new q).fromJSON(r||[]),image:X._O(a),preloadBloomFilter:!0},o),{appDomain:l}=c;super(t,K(c,["appDomain"]),`https://${l}`)}async handleRedirect(t,e){if(t.status===U.BaqendRedirect){const s=this._N(e,t.headers.get("location")),i=new Headers(t.headers);return i.set("location",s),new Response(null,{headers:i,status:U.MovedPermanently,statusText:t.statusText})}return t}_N(t,e){if(e.startsWith("http"))return e;if(e.startsWith("//"))return`https:${e}`;const s=new URL(t.url);if(e.startsWith("/"))return`${s.origin}${e}`;const i=`${s.origin}${s.pathname}`;return i.endsWith("/")?`${i}${e}`:`${i.substr(0,i.lastIndexOf("/")+1)}${e}`}static _O(t){return t?t instanceof Array?t.map(t=>({rules:t.rules&&(new q).fromJSON(t.rules),options:X._P(t.options)})).reverse():X._P(t):{}}static _P(t){return"number"==typeof t.quality?t.quality=Math.max(1,Math.min(100,Math.round(t.quality))):!1===t.quality&&(t.quality=100),t}}function Q(t,e){const s=3&e.length,i=e.length-s,n=3432918353,r=461845907;let a,o,c,l;for(a=t,l=0;l<i;)c=255&e.charCodeAt(l)|(255&e.charCodeAt(l+=1))<<8|(255&e.charCodeAt(l+=1))<<16|(255&e.charCodeAt(l+=1))<<24,l+=1,a=27492+(65535&(o=5*(65535&(a=(a^=c=(65535&(c=(c=(65535&c)*n+(((c>>>16)*n&65535)<<16)&4294967295)<<15|c>>>17))*r+(((c>>>16)*r&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(c=0,s){case 3:c^=(255&e.charCodeAt(l+2))<<16;case 2:c^=(255&e.charCodeAt(l+1))<<8;case 1:a^=c=(65535&(c=(c=(65535&(c^=255&e.charCodeAt(l)))*n+(((c>>>16)*n&65535)<<16)&4294967295)<<15|c>>>17))*r+(((c>>>16)*r&65535)<<16)&4294967295}return a^=e.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0}class Y{constructor(t,e=62353,s=5){this._g=t,this._h=e,this._i=s}static fromBuffer(t){const e=new Int32Array(t,0,2),[s,i]=e;return new Y(new Uint8Array(t,8),s,i)}static fromJSON(t){return new Y((e=t.b,Uint8Array.from([...atob(e)].map(t=>t.charCodeAt(0)))),t.m,t.h);var e}contains(t){return this._e(t).every(t=>this._f(t))}_e(t){const e=[],s=Q(0,t),i=Q(s,t);for(let t=0;t<this._i;t+=1)e[t]=(s+t*i)%this._h;return e}_f(t){const e=this._g[t>>3];if(e){return 0!=(e&1<<(7&t))}return!1}}const Z="1",tt=`${location.origin}/com.baqend.speedkit.clockdrift`;class et{constructor(t,e,s){this._S=null,this._T=0,this._U=!1,this._V=!1,this._W=!1,this._X=0,this._Y=t,this._Q=e,this._R=s}isNotReady(){return null==this._S||this._T<=Date.now()}isStale(t){return this._S.contains(t)}isDisconnected(){return this._V}getRevision(){return Z}getClockDrift(){return this._X}setClockDrift(t){this._X=t}preload(){return async function(t,...e){const s=caches.open(R);return(await s).addAll(e)}(0,this._R)}async init(){const t=Date.now();if(this._S)return this._T>t||(this.fetchBloomFilter(),!1);this.setClockDrift(await E(tt,this._X));const e=await A(this._R,R);if(e){const s=this.getClockDrift();if(this._T=T(e,s)+this._Q,this._T>t){const t=await e.json();return this._S=Y.fromJSON(t),!0}}return this.fetchBloomFilter(),!1}connect(){this._V=!1}async disconnect(t){return this._V=!0,"unregister"===t?(this._W=!0,void self.registration.unregister()):"noReconnect"===t||this._W?void 0:(await M(this._Y),this.fetchBloomFilter())}async fetchBloomFilter(t=!1){if(this._U||!navigator.onLine)return;this._U=!0;let e=!1;try{const t={accept:"application/octet-stream, application/json;q=0.7"},s=new URL(this._R);s.searchParams.append("BCB","1"),s.searchParams.append("skversion","1.8.0");const i=await fetch(s.toString(),{headers:t}),n=i.clone();if(i.status!==U.Ok)throw i.status===U.Forbidden&&(e=!0),new Error(`Bloom filter fetch failed, status: ${i.status}`);if((i.headers.get("baqend-speed-kit")||"").includes("disabled=true"))throw new Error("Speed Kit Disabled on Server");this._W||(this._V=!1);const r=i.headers.get("content-type");if(r.startsWith("application/octet-stream")){const t=await i.arrayBuffer();this._S=Y.fromBuffer(t)}else{if(!r.startsWith("application/json"))throw new Error(`Weird server reply: ${r}`);{const t=await i.json();this._S=Y.fromJSON(t)}}const a=Date.now();this._T=a+this._Q;const o=Date.parse(i.headers.get("date"));this.setClockDrift(a-o),F(tt,this.getClockDrift()),P(this._R,n,R),this._U=!1}catch(t){return this._U=!1,this.disconnect(e?"unregister":"reconnect")}}}class st{constructor(t){t.addEventListener("install",t=>{t.waitUntil(this.install())}),t.addEventListener("activate",e=>{e.waitUntil(this.activate(e).then(()=>t.clients.claim()))}),t.addEventListener("fetch",t=>{this.fetch(t)}),t.addEventListener("push",t=>{this.push(t)}),t.addEventListener("notificationclick",t=>{this.notificationclick(t)})}async install(){return self.skipWaiting()}}class it{constructor(){this._L=[]}startWaiting(){return new Promise((t,e)=>{this.waitPromiseResolver=t})}waitFor(t){this._L.push(t)}async finishWaiting(t){await Promise.all(this._L),this.waitPromiseResolver&&this.waitPromiseResolver(t)}}class nt{constructor(t=""){this._M=t}fromString(t){this._M=t}getItem(t){if(!t)return null;const e=encodeURIComponent(t).replace(/[-.+*]/g,"\\$&"),s=new RegExp(`(?:(?:^|.*;)\\s*${e}\\s*\\=\\s*([^;]*).*$)|^.*$`);return decodeURIComponent(this._M.replace(s,"$1"))||null}keys(){return this._M.replace(/((?:^|\s*;)[^=]+)(?=;|$)|^\s*|\s*(?:=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:=[^;]*)?;\s*/).map(t=>decodeURIComponent(t))}}const rt=`${location.origin}/com.baqend.speedkit.config`,at=`${location.origin}/com.baqend.speedkit.cookie`;new class extends st{constructor(t){super(t),this._I=!1,this._J=!1,this._K=new nt,t.addEventListener("message",t=>{t.waitUntil(this._B(t))})}async activate(t){await this._E()}push(t){if(!t.data)return;const e=t.data.json(),s=e.title;t.waitUntil(self.registration.showNotification(s,e))}fetch(t){const{request:e}=t,s=this._J;if("navigate"===t.request.mode&&(this._J=!1),!function(t){return t.url.startsWith("http")}(e))return;if(function(t){return"GET"!==t.method&&"HEAD"!==t.method}(e))return void("navigate"===e.mode&&(this._I=!0));if(this._I&&"navigate"===e.mode)return void(this._I=!1);if(function(t){return"dynamic"===t.headers.get("baqend-speed-kit-request")}(e))return s?void 0:void t.respondWith(this._A());if(navigator.onLine&&this._bloomFilterProvider&&this._bloomFilterProvider.isDisconnected())return;if(this._workerCache&&!this._workerCache.shouldHandle(e,this._K))return;const i=new it;t.waitUntil(i.startWaiting());const[n,r]=G();"Firefox"===n&&59===r&&"navigate"!==e.mode&&e.url.includes("#")&&h(e)||t.respondWith((async()=>(await this._E(),this._workerCache&&this._bloomFilterProvider?navigator.onLine&&this._bloomFilterProvider.isDisconnected()?this._workerCache.handleExternalRequest(e):this._workerCache.shouldHandle(e,this._K)&&await this._workerCache.isEnabledOnSite(t)?(await this._bloomFilterProvider.init(),"navigate"===t.request.mode&&(this._J=!0),this._workerCache.handleRequest(e,i,this._K)):this._workerCache.handleExternalRequest(e):fetch(e)))())}async _A(){return new Response("",{status:444,statusText:"Page was not served via Speed Kit"})}async _B(t){const e=t.data;switch(e.type){case"send-config":return this._C(e.data.config,e.data.cookie);case"send-cookies":return this._D(e.data);case"clear-cache":return async function(){const t=(await caches.keys()).filter(t=>t.startsWith(R)).map(t=>caches.delete(t));return await Promise.all(t)}();case"disconnect":return this._bloomFilterProvider&&this._bloomFilterProvider.disconnect("noReconnect");case"connect":return this._bloomFilterProvider&&this._bloomFilterProvider.connect();case"fetch-bloom-filter":return this._bloomFilterProvider&&this._bloomFilterProvider.fetchBloomFilter(!0);default:throw new Error(`Received unsupported ${e.type} message`)}}async _C(t,e){return this._F(t),this._G(e),Promise.all([F(rt,t),F(at,e)])}async _D(t){return this._G(t),F(at,t)}async _E(){if(this._workerCache)return;const[t,e]=await Promise.all([E(at),E(rt)]);if(t&&this._G(t),e)try{this._F(e)}catch(t){}}_F(t){if(this._workerCache)return;const e=t.maxStaleness||6e4,s=t.reconnectInterval||6e4,i=`https://${t.appDomain||"{}.app.baqend.com".replace("{}",t.appName)}/v1/bloomfilter`;this._bloomFilterProvider=new et(s,e,i),!1!==t.preloadBloomFilter&&this._bloomFilterProvider.fetchBloomFilter(),this._workerCache=new X(this._bloomFilterProvider,t)}_G(t){this._K.fromString(t)}notificationclick(t){const e=t.notification,s=t.action,i=e.data.closeNotification;if("close"===s)return e.close();t.waitUntil(this._H(e.data.launchUrl)),i&&setTimeout(e.close.bind(e),1e4)}async _H(t){if(t)return self.clients.openWindow(t);const e=await self.clients.matchAll();return e.length>0?e[0].focus():self.clients.openWindow("/")}}(self)}]);